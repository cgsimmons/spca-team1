
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXclu8PhDGVun2bDikmbNE5YUUNRFG204&callback=initMap"
 type="text/javascript"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src="https://cdn.klokantech.com/maptilerlayer/v1/index.js"></script>

<div class = 'container-fluid'>
 <div class="row">
  <!-- 👇 START OF SIDEBAR -->
  <div id='menu' class='sidebar nopadding col-xs-12 col-md-4'>
    <section id= 'menu-main'>
      <% if user_signed_in? %>
        <section class='side-section side-user'>
          <% if current_user.avatar.present? %>
            <%= image_tag current_user.avatar %>
          <% end %>
          <%= current_user.full_name %>
        </section>
      <% end %>
      <p class="side-heading">Make a Report</p>
      <section id="button-newLost" class="side-section side-lost-report">
        <p class="side-links">Lost Pet</p>
      </section>
      <section id="button-newFound" class="side-section side-lost-report">
        <p class="side-links">Found/Sighted Pet</p>
      </section>
      <p class="side-heading">Account</p>
      <section id="button-listReport" class="side-section side-lost-report">
        <p class="side-links">My Report</p>
      </section>
      <section id="button-listMessage" class="side-section side-lost-report">
        <p class="side-links">Messages</p>
      </section>
      <section id="button-setting" class="side-section side-lost-report">
        <p class="side-links">Settings</p>
      </section>
      <section id="button-about" class="side-section side-lost-report">
        <p class="side-links">About find my pet</p>
      </section>
    </section>
    <section id='listReport'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      <p class="side-links">Lost Pet</p>
      <ul id='list-lost'>
      </ul>
      <p class="side-links">Found/Sighted Pet</p>
      <ul id='list-found'>
      </ul>
    </section>
    <section id='listMessage'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY Messages
      </div>
      <p class="side-heading">Lost Pet</p>
      <ul id='list-message'>
      </ul>
    </section>
    <section id='setting'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> Setting
      </div>
      <section id="button-location" class="side-section side-lost-report">
        <p class="side-links">Location</p>
      </section>
      <section id="button-notification" class="side-section side-lost-report">
        <p class="side-links">Notification</p>
      </section>
      <section id="button-signout" class="side-section side-lost-report">
        <p class="side-links">Sign Out</p>
      </section>
    </section>
    <section id='about'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      ABOUT
    </section>
    <section id='newReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      <div class = 'ReportLostForm'>
        NEW REPORT
      </div>
      <section id="button-sumbitNewReportFound" class="side-section side-lost-report">
        <p class="side-links">Preivew</p>
      </section>
    </section>
    <section id='previewReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      <div id='previewReportFoundData'>
      </div>
      <section id="button-sumbitPreviewReportFound" class="side-section side-lost-report">
        <p class="side-links">Comfirm</p>
      </section>
    </section>
    <section id='completeReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      <img id='pinImageLost'>
      <section id="button-sumbitCompleteReportFound" class="side-section side-lost-report">
        <p class="side-links">Confirm</p>
      </section>
    </section>
    <section id='showReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
        <a class='button-facebook'>Share</a>
      </div>
      <div id='showReportFoundData'>
      </div>
      <section id="button-reportAnotherFound" class="side-section side-lost-report">
        <p class="side-links">Report</p>
      </section>
      <section id="button-trackPet" class="side-section side-lost-report">
        <p class="side-links">Track Pet</p>
      </section>
      <section class="side-section side-lost-report button-newMessage">
        <p class="side-links">Message</p>
      </section>
    </section>
    <section id='editReportFound'>
    </section>
    <section id='newReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Report
      </div>
      <div class = 'ReportLostForm'>
      </div>
      <section id="button-sumbitNewReportLost" class="side-section side-lost-report">
        <p class="side-links">Preivew</p>
      </section>
    </section>
    <section id='previewReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      <div id='previewReportLostData'>
      </div>
      <section id="button-sumbitPreviewReportLost" class="side-section side-lost-report">
        <p class="side-links">Confirm</p>
      </section>
    </section>
    <section id='completeReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      <img id='pinImageLost'>
      completed a report
      <section id="button-sumbitCompleteReportLost" class="side-section side-lost-report">
        <p class="side-links">Confirm</p>
      </section>
    </section>
    <section id='showReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
        <a class='button-facebook'>Share</a>
      </div>
      <div id='showReportLostData'>
      </div>
      <section class="side-section side-lost-report button-newMessage">
        <p class="side-links">Message</p>
      </section>
    </section>
    <section id='editReportLost'>
    </section>
    <section id='showMessage'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> Message
      </div>
      <div class='messageData'>
      </div>
    </section>
    <section id='listFilterdReport'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY Messages
      </div>
      <ul id='list-filterd'>
      </ul>
    </section>
    <section id='newMessage'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY Messages
      </div>
      <img id='messageIMG'>
      <textarea id='messageBody'></textarea>
      <section id="button-sendMessage" class="side-section side-lost-report">
        <p class="side-links">Send</p>
      </section>
    </section>

    <p class="side-footer"><%= fa_icon 'paw' %> Find my Pet V.01 </p>
  </div>

  <!-- sidebar template -->
    <script id="showMessage" type="x-tmpl-mustache">
      <img src={{photo1}}>
      <p>{{body}}</p>
    </script>
    <script id="report-summary" type="x-tmpl-mustache">
      <li data-id={{id}}>
        <p>{{note}}</p>
        <hr>
      </li>
    </script>
    <script id="message-summary" type="x-tmpl-mustache">
      <li data-id={{id}}>
        <img src={{photo1}}>
        <p>{{body}}</p>
        <hr>
      </li>
    </script>

    <script id="reportShow" type="x-tmpl-mustache">
      <img data-id={{id}} scr={{photo}}>
      <p>Pet Type: {{pet_type}}</p>
      <p>Breed : {{breed}}</p>
      <p>Name : {{name}}</p>
      <p>Sex : {{sex}} </p>
      <p>Coulour : {{color}} </p>
      <p>Age : {{age}} </p>
      <p>Last Seen : {{last_seen_address}} </p>
      <p>Note : {{note}} </p>
    </script>

    <script id="user-info" type="x-tmpl-mustache">
      <div>
        <img src = {{avator}}>
        <p>Hello: {{first_name}}
      </div>
    </script>

  <!-- END OF SIDEBAR ☝️ -->

  <!-- 👨 MUSTACHE TEMPLATES -->

  <script id="showMessage" type="x-tmpl-mustache">
    <img src={{photo1}}>
    <p>{{body}}</p>
  </script>
  <script id="report-summary" type="x-tmpl-mustache">
    <li data-id={{id}}>
      <p>{{note}}</p>
      <hr>
    </li>
  </script>
  <script id="message-summary" type="x-tmpl-mustache">
    <li data-id={{id}}>
      <img src={{photo1}}>
      <p>{{body}}</p>
      <hr>
    </li>
  </script>

  <script id="reportShow" type="x-tmpl-mustache">
    <img data-id={{id}} scr={{photo}}>
    <p>Breed : {{breed}}</p>
    <p>Name : {{name}}</p>
    <p>Sex : {{sex}} </p>
    <p>Coulour : {{color}} </p>
    <p>Age : {{age}} </p>
    <p>Last Seen : {{last_seen_address}} </p>
    <p>Note : {{note}} </p>
  </script>

  <script id="user-info" type="x-tmpl-mustache">
    <div>
      <img src = {{avator}}>
      <p>Hello: {{first_name}}
    </div>
  </script>

<!-- 👨 END OF MUSTACHE TEMPLATES -->

<!-- 🗺 MAP VIEW -->

  <div class='map-view nopadding col-xs-12 col-md-8'>
    <div id="map-container">
        <div id="map-canvas"></div>
          <div id="legend"><h3>Pets</h3></div>

    </div>
  </div>

  <!-- END OF MAP VIEW -->
</div>

<script>
var addLegend = function () {
  var iconBase = '';
  var icons = {
    lost: {
      name: 'Lost',
      icon: iconBase + 'http://storage8.static.itmages.com/i/16/1120/h_1479684823_4696094_cedddc5c3a.png'
    },
    sighted: {
      name: 'Sighted',
      icon: iconBase + 'http://storage6.static.itmages.com/i/16/1120/h_1479684799_7772859_c01f214934.png'
    },
  };
  var legend = document.getElementById('legend');

  for (var key in icons) {
    console.log(key);
    var type = icons[key];
    var name = type.name;
    var icon = type.icon;
    var div = document.createElement('div');
    div.innerHTML = '<img src="' + icon + '"> ' + name;
    legend.appendChild(div);
  }
//
  map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
}

//create map
function initMap(){
  var latitude = 49.2827291;
  var longitude = -123.12073750000002;

  handler = Gmaps.build('Google');
  handler.buildMap({
      provider: {
        mapTypeControl: false,
        streetViewControl: false,
        zoom: 14,
        center: {lat: latitude, lng: longitude},

      },
      internal: {id: 'map-canvas'}}, function(){
    // markers = handler.addMarkers([
    //   {
    //     "lat": latitude,
    //     "lng": longitude,
    //     "picture": {
    //       "url": "http://people.mozilla.com/~faaborg/files/shiretoko/firefoxIcon/firefox-32.png",
    //       "width":  32,
    //       "height": 32
    //     },
    //     "infowindow": "hello!"
    //   }
    // ]);

    var markers = handler.addMarkers(<%=raw @markers.to_json %>);

    if(markers.length != 0){
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
     }
    map = (handler.map.serviceObject.data.map);
    var geoloccontrol = new klokantech.GeolocationControl(map, 18);
    // if(navigator.geolocation)
    //   navigator.geolocation.getCurrentPosition(displayOnMap);

    addLegend();
  });
}

// in listener
//

</script>
